<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Category</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark fixed-top">
        <div class="container">
            <a href="admin-dashboard.html" class="navbar-brand">Megatower Hub
                <span class="text-secondary" style="font-size: 0.8em;">Admin Dashboard</span>
            </a>

            <button class="navbar-toggler" 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navmenu" 
            aria-controls="navmenu" 
            aria-expanded="false" 
            aria-label="Toggle navigation menu">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navmenu">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link text-light" id="notificationsLink">Notifications <span id="unreadCountBadge" class="badge bg-danger"></span></a>
                    </li>
                    <li class="nav-item">
                        <a href="admin-complaints.html" class="nav-link text-light">Complaints</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Request
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="admin-maintenance.html">Maintenance</a>
                            <a class="dropdown-item" href="admin-cleaning.html">Cleaning</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light" href="#" id="roomsDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Rooms
                        </a>
                        <div class="dropdown-menu" aria-labelledby="roomsDropdown">
                            <a class="dropdown-item" href="admin-room-category.html">Room Category</a>
                            <a class="dropdown-item" href="admin-reservations.html">Reservations</a> <!-- Added link to reservations -->
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="user-management.html" class="nav-link text-light">Users</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-light" onclick="logout()" id="logoutBtn">Logout</a>
                    </li> 
                </ul>
            </div>
        </div>   
    </nav>

    <!-- Admin Notifications Modal -->
    <div class="modal fade" id="adminNotificationsModal" tabindex="-1" aria-labelledby="adminNotificationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="adminNotificationsModalLabel">Admin Notifications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Notifications will be populated dynamically here -->
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row">
            <!-- Add Room Category Form -->
            <div class="col-md-6 mb-3">
                <h2>Add Room Category</h2>
                <form id="roomCategoryForm" class="category-form">
                    <div class="mb-3">
                        <label for="category" class="form-label">Category</label>
                        <input type="text" class="form-control" id="category" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Room Category</button>
                </form>
            </div>
            <!-- Room Category Table -->
            <div class="col-md-6 mb-3">
                <h2>Room Category</h2>
                <table class="table room-table border">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Category</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="roomCategoryTableBody">
                        <!-- Room category data will be dynamically populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <h2>Add Room</h2>
                <form id="roomForm" class="room-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="room" class="form-label">Room</label>
                                <input type="text" class="form-control" id="room" required>
                            </div>
                            <div class="mb-3">
                                <label for="capacity" class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="capacity" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="categorySelect" class="form-label">Category</label>
                                <select class="form-select" id="categorySelect" required>
                                    <!-- Options will be dynamically populated -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="floor" class="form-label">Floor</label>
                                <input type="number" class="form-control" id="floor" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="type" class="form-label">Type</label>
                                <select class="form-select" id="type" required>
                                    <option value="transient">Transient</option>
                                    <option value="lease">Lease</option>
                                    <option value="buy">Buy</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="price" class="form-label">Price</label>
                                <input type="number" class="form-control" id="price" required>
                            </div>
                        </div>                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="availability" class="form-label">Availability</label>
                                <select class="form-select" id="availability" required>
                                    <option value="available">Available</option>
                                    <option value="not-available">Not Available</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="amenities" class="form-label">Amenities</label>
                                <div class="input-group">
                                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#amenitiesModal">Select Amenities</button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="image" class="form-label">Image</label>
                            <input type="file" class="form-control" id="image" accept="image/*" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Room</button>
                </form>
            </div>            
            <!-- Added Rooms Table -->
            <div class="col-md-6">
                <h2>Added Rooms</h2>
                <table class="table room-table border">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Image</th>
                            <th>Category</th>
                            <th>Room</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="addedRoomsTableBody">
                        <!-- Added rooms data will be dynamically populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Amenities Modal -->
    <div class="modal fade" id="amenitiesModal" tabindex="-1" aria-labelledby="amenitiesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="amenitiesModalLabel">Select Amenities</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Kitchen</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dishes and dining utensils" id="amenityDishes">
                        <label class="form-check-label" for="amenityDishes">Dishes and dining utensils</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Microwave" id="amenityMicrowave">
                        <label class="form-check-label" for="amenityMicrowave">Microwave</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Refrigerator" id="amenityRefrigerator">
                        <label class="form-check-label" for="amenityRefrigerator">Refrigerator</label>
                    </div>

                    <h6>Bathroom</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Body wash" id="amenityBodyWash">
                        <label class="form-check-label" for="amenityBodyWash">Body wash</label>
                    </div>

                    <h6>Bedroom</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fans (ceiling or portable)" id="amenityFans">
                        <label class="form-check-label" for="amenityFans">Fans (ceiling or portable)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Linens" id="amenityLinens">
                        <label class="form-check-label" for="amenityLinens">Linens</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hair dryer" id="amenityHairDryer">
                        <label class="form-check-label" for="amenityHairDryer">Hair dryer</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Toiletries" id="amenityToiletries">
                        <label class="form-check-label" for="amenityToiletries">Toiletries</label>
                    </div>

                    <h6>General</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Laundromat nearby" id="amenityLaundromat">
                        <label class="form-check-label" for="amenityLaundromat">Laundromat nearby</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Internet" id="amenityInternet">
                        <label class="form-check-label" for="amenityInternet">Internet</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="TV" id="amenityTV">
                        <label class="form-check-label" for="amenityTV">TV</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Wi-Fi" id="amenityWiFi">
                        <label class="form-check-label" for="amenityWiFi">Wi-Fi</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Coffee or tea" id="amenityCoffeeTea">
                        <label class="form-check-label" for="amenityCoffeeTea">Coffee or tea</label>
                    </div>

                    <h6>Security</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Doorman" id="amenityDoorman">
                        <label class="form-check-label" for="amenityDoorman">Doorman</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fire extinguisher" id="amenityFireExtinguisher">
                        <label class="form-check-label" for="amenityFireExtinguisher">Fire extinguisher</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Smoke detector" id="amenitySmokeDetector">
                        <label class="form-check-label" for="amenitySmokeDetector">Smoke detector</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Security [24-hour]" id="amenitySecurity24">
                        <label class="form-check-label" for="amenitySecurity24">Security [24-hour]</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveAmenities()">Save Amenities</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Room Category Modal -->
    <div class="modal fade" id="editRoomCategoryModal" tabindex="-1" aria-labelledby="editRoomCategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRoomCategoryModalLabel">Edit Room Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomCategoryForm">
                        <div class="mb-3">
                            <label for="editCategory" class="form-label">Category</label>
                            <input type="text" class="form-control" id="editCategory" required>
                        </div>
                        <input type="hidden" id="editRoomCategoryId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEditedRoomCategory()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Room Modal -->
    <div class="modal fade" id="editRoomModal" tabindex="-1" aria-labelledby="editRoomModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRoomModalLabel">Edit Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomForm">
                        <div class="mb-3">
                            <label for="editRoomName" class="form-label">Room Name</label>
                            <input type="text" class="form-control" id="editRoomName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomCategory" class="form-label">Room Category</label>
                            <select class="form-select" id="editRoomCategory" required>
                                <!-- Options will be dynamically populated -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomCapacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="editRoomCapacity" required>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomFloor" class="form-label">Floor</label>
                            <input type="number" class="form-control" id="editRoomFloor" required>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomType" class="form-label">Type</label>
                            <select class="form-select" id="editRoomType" required>
                                <option value="transient">Transient</option>
                                <option value="lease">Lease</option>
                                <option value="buy">Buy</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomPrice" class="form-label">Price</label>
                            <input type="number" class="form-control" id="editRoomPrice" required>
                        </div>
                        <div class="mb-3">
                            <label for="editRoomAvailability" class="form-label">Availability</label>
                            <select class="form-select" id="editRoomAvailability" required>
                                <option value="available">Available</option>
                                <option value="not-available">Not Available</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-info" onclick="prepareAndShowEditAmenitiesModal(); $('#editRoomModal').modal('hide');">Edit Amenities</button>
                        </div>
                        <input type="hidden" id="editRoomId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEditedRoom()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>

    <script src="admin-notifications.js"></script>

    <script>
        // References to Firebase services
        const database = firebase.database();
        const storage = firebase.storage();

        // Room category form and table body
        const roomCategoryForm = document.getElementById('roomCategoryForm');
        const roomCategoryTableBody = document.getElementById('roomCategoryTableBody');
        const roomForm = document.getElementById('roomForm');
        const addedRoomsTableBody = document.getElementById('addedRoomsTableBody');

        // Function to add a room category
        roomCategoryForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Get form values (room category data)
            const category = document.getElementById('category').value;
            const name = category; // Removed concatenation with 'type'

            // Add room category data to Firebase Realtime Database
            const roomCategoryData = {
                category: category,
                name: name
            };
            database.ref('room_category').push(roomCategoryData);

            roomCategoryForm.reset();
        });

        // Display room category data in the table
        database.ref('room_category').on('value', function(snapshot) {
            roomCategoryTableBody.innerHTML = '';
            let count = 1;

            snapshot.forEach(function(childSnapshot) {
                const data = childSnapshot.val();
                const key = childSnapshot.key;
                const category = data.category;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${count++}</td>
                    <td>${category}</td>
                    <td>
                        <button type="button" class="btn btn-primary btn-sm" onclick="editRoomCategory('${key}', '${category}')">Edit</button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="deleteRoomCategory('${key}')">Delete</button>
                    </td>
                `;
                roomCategoryTableBody.appendChild(tr);
            });
        });

        // Function to edit room category
        function editRoomCategory(id, category) {
            document.getElementById('editCategory').value = category;
            document.getElementById('editRoomCategoryId').value = id;
            // Open the Bootstrap modal using jQuery
            $('#editRoomCategoryModal').modal('show');
        }

        // Function to save edited room category
        function saveEditedRoomCategory() {
            const id = document.getElementById('editRoomCategoryId').value;
            const category = document.getElementById('editCategory').value;

            database.ref('room_category').child(id).update({
                category: category
            }).then(() => {
                $('#editRoomCategoryModal').modal('hide');
            }).catch(error => {
                console.error('Error updating room category: ', error);
            });
        }

        // Function to delete room category and its associated rooms
        function deleteRoomCategory(key) {
            if (confirm('Are you sure you want to delete this room category?')) {
                // First, get the category name to match against room categories
                database.ref('room_category/' + key).once('value', snapshot => {
                    const categoryToDelete = snapshot.val().category;

                    // Then, delete the category
                    database.ref('room_category').child(key).remove()
                        .then(() => {
                            console.log('Room category deleted successfully');

                            // Now, iterate over all rooms to find and delete those with the matching category
                            database.ref('rooms').once('value', roomsSnapshot => {
                                roomsSnapshot.forEach(roomSnapshot => {
                                    const roomData = roomSnapshot.val();
                                    if(roomData.category === categoryToDelete) {
                                        // If room's category matches the deleted category, remove it
                                        database.ref('rooms').child(roomSnapshot.key).remove();
                                    }
                                });
                            });
                        })
                        .catch(error => {
                            console.error('Error deleting room category: ', error);
                        });
                });
            }
        }

        function saveAmenities() {
            // Example for editing context; adapt as needed based on how you track context
            const roomId = document.getElementById('editRoomId').value; // or another way you choose to track the editing room ID
            const selectedAmenities = [];

            document.querySelectorAll('#amenitiesModal .form-check-input:checked').forEach(checkbox => {
                selectedAmenities.push(checkbox.value);
            });

            if (roomId) {
                // Editing existing room's amenities
                database.ref('rooms/' + roomId).update({
                    amenities: selectedAmenities
                }).then(() => {
                    console.log('Amenities updated successfully');
                    $('#amenitiesModal').modal('hide');
                }).catch(error => {
                    console.error('Error updating amenities: ', error);
                });
            } else {
                // Handle adding new room logic if needed
            }
        }


        // Function to add a room
        roomForm.addEventListener('submit', function(event) {
            event.preventDefault();

            // Get form values (room data)
            const room = document.getElementById('room').value;
            const category = document.getElementById('categorySelect').value;
            const capacity = document.getElementById('capacity').value;
            const floor = document.getElementById('floor').value;
            const type = document.getElementById('type').value;
            const price = document.getElementById('price').value;
            const availability = document.getElementById('availability').value;
            const image = document.getElementById('image').files[0];
            const name = room; // Removed concatenation with 'type'

            // Get selected amenities
            const selectedAmenities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(function(checkbox) {
                selectedAmenities.push(checkbox.value);
            });

            // Define the saveAmenities function here
            function saveAmenities() {
                // Your saveAmenities function implementation here
                console.log("Adding amenities...");
                // You can access selectedAmenities here
                console.log("Selected amenities:", selectedAmenities);
            }

            // Upload image to Firebase Storage
            const storageRef = storage.ref('room_images/' + image.name);
            storageRef.put(image)
                .then(snapshot => snapshot.ref.getDownloadURL())
                .then(downloadURL => {
                    // Add room data to Firebase Realtime Database
                    const roomData = {
                        room: room,
                        category: category,
                        capacity: capacity,
                        floor: floor,
                        type: type,
                        price: price,
                        availability: availability,
                        name: name,
                        image: downloadURL,
                        amenities: selectedAmenities // Add selected amenities to room data
                    };
                    database.ref('rooms').push(roomData);
                })
                .catch(error => {
                    console.error('Error uploading image: ', error);
                });

            roomForm.reset();
        });
        // Populate category select options
        database.ref('room_category').on('value', function(snapshot) {
            const categorySelect = document.getElementById('categorySelect');
            categorySelect.innerHTML = '';
            snapshot.forEach(function(childSnapshot) {
                const data = childSnapshot.val();
                const category = data.category;
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        });

        <!-- Display added rooms data in the table -->
        database.ref('rooms').on('value', function(snapshot) {
            addedRoomsTableBody.innerHTML = '';
            let count = 1;

            snapshot.forEach(function(childSnapshot) {
                const data = childSnapshot.val();
                const key = childSnapshot.key;
                const room = data.room;
                const category = data.category;
                const capacity = data.capacity;
                const floor = data.floor;
                const type = data.type;
                const price = data.price;
                const availability = data.availability;
                const imageUrl = data.image;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${count++}</td>
                    <td><img src="${imageUrl}" alt="${room}" style="max-width: 100px;"></td>
                    <td>${category}</td>
                    <td>
                        Room: ${room}<br>
                        Capacity: ${capacity}<br>
                        Floor: ${floor}<br>
                        Type: ${type}<br>
                        Price: ${price}<br>
                        <button type="button" class="btn btn-primary btn-sm" onclick="toggleAmenities('${key}')">Amenities</button>
                        <div id="amenities${key}" style="display: none;"></div>
                    </td>
                    <td>Status: ${availability}</td>
                    <td>
                        <button type="button" class="btn btn-primary btn-sm" onclick="editRoom('${key}', '${room}', '${category}', '${capacity}', '${floor}', '${type}', '${price}', '${availability}')">Edit</button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="deleteRoom('${key}')">Delete</button>
                    </td>
                `;
                addedRoomsTableBody.appendChild(tr);
            });
        });

        // Function to toggle display of amenities
        function toggleAmenities(roomId) {
            const amenitiesDiv = document.getElementById(`amenities${roomId}`);
            if (amenitiesDiv.style.display === 'none') {
                // Fetch and display amenities for the room
                fetchAmenities(roomId, amenitiesDiv);
                amenitiesDiv.style.display = 'block';
            } else {
                amenitiesDiv.style.display = 'none';
            }
        }

        // Function to fetch and display amenities for a room
        function fetchAmenities(roomId, amenitiesDiv) {
            database.ref('rooms').child(roomId).child('amenities').once('value', function(snapshot) {
                const amenities = snapshot.val();
                let amenitiesHTML = '<strong>Amenities:</strong><br>';
                for (const amenity in amenities) {
                    amenitiesHTML += `${amenities[amenity]}<br>`;
                }
                amenitiesDiv.innerHTML = amenitiesHTML;
            });
        }


        // Function to edit room
        function editRoom(id, room, category, capacity, floor, type, price, availability) {
            // Set values in the edit modal form
            document.getElementById('editRoomName').value = room;
            document.getElementById('editRoomCapacity').value = capacity;
            document.getElementById('editRoomFloor').value = floor;
            document.getElementById('editRoomType').value = type;
            document.getElementById('editRoomPrice').value = price;
            document.getElementById('editRoomAvailability').value = availability;
            document.getElementById('editRoomId').value = id;

            // Populate the category dropdown with options
            const editRoomCategorySelect = document.getElementById('editRoomCategory');
            editRoomCategorySelect.innerHTML = ''; // Clear previous options

            // Fetch categories from Firebase Realtime Database
            database.ref('room_category').once('value', function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    const category = childSnapshot.val().category;
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    editRoomCategorySelect.appendChild(option);
                });
            });

            // Open the Bootstrap modal using jQuery
            $('#editRoomModal').modal('show');
        }

        // Function to save edited room details
        function saveEditedRoom() {
            const id = document.getElementById('editRoomId').value;
            const room = document.getElementById('editRoomName').value;
            const category = document.getElementById('editRoomCategory').value;
            const capacity = document.getElementById('editRoomCapacity').value;
            const floor = document.getElementById('editRoomFloor').value;
            const type = document.getElementById('editRoomType').value;
            const price = document.getElementById('editRoomPrice').value;
            const availability = document.getElementById('editRoomAvailability').value;

            // Update room details in Firebase Realtime Database
            database.ref('rooms').child(id).update({
                room: room,
                category: category,
                capacity: capacity,
                floor: floor,
                type: type,
                price: price,
                availability: availability
            }).then(() => {
                // Close the modal after saving changes
                $('#editRoomModal').modal('hide');
            }).catch(error => {
                console.error('Error updating room details: ', error);
            });
        }

        // Function to delete room
        function deleteRoom(key) {
            if (confirm('Are you sure you want to delete this room?')) {
                database.ref('rooms').child(key).remove()
                    .then(() => {
                        console.log('Room deleted successfully');
                    })
                    .catch(error => {
                        console.error('Error deleting room: ', error);
                    });
            }
        }

        function prepareAndShowEditAmenitiesModal() {
            const roomId = document.getElementById('editRoomId').value;
            // Assume roomId is correctly set when opening the edit room modal
            
            // Load current amenities and mark them as checked in the amenitiesModal
            database.ref('rooms/' + roomId + '/amenities').once('value', snapshot => {
                const currentAmenities = snapshot.val() || [];
                // Reset checkboxes
                document.querySelectorAll('#amenitiesModal .form-check-input').forEach(checkbox => {
                    checkbox.checked = currentAmenities.includes(checkbox.value);
                });

                // Show the modal
                $('#amenitiesModal').modal('show');
            });

            // Store roomId or context if needed to differentiate between add and edit
            // This could be storing in a hidden input inside the modal, setting a global variable, etc.
        }

        $('#amenitiesModal').on('hidden.bs.modal', function () {
            // Check if we're coming from the edit room context
            const roomId = document.getElementById('editRoomId').value;
            if (roomId) {
                $('#editRoomModal').modal('show');
            }
        });

    </script>

    <script>
        // Function to handle logout
        function logout() {
            // Check if a user is authenticated
            const user = firebase.auth().currentUser;
            if (user) {
                // If authenticated, sign out
                firebase.auth().signOut().then(() => {
                    // Sign-out successful.
                    window.location.href = 'index.html';
                }).catch((error) => {
                    // An error happened.
                    console.error('Logout error:', error);
                });
            } else {
                // If not authenticated, redirect to index.html
                window.location.href = 'index.html';
            }
        }
    </script>

</body>
</html>