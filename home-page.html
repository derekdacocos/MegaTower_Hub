<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Megatower Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
  rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
  crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="styles.css">

  <!-- Start of Async Drift Code -->
  <script>
  "use strict";
  
  !function() {
    var t = window.driftt = window.drift = window.driftt || [];
    if (!t.init) {
      if (t.invoked) return void (window.console && console.error && console.error("Drift snippet included twice."));
      t.invoked = !0, t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
      t.factory = function(e) {
        return function() {
          var n = Array.prototype.slice.call(arguments);
          return n.unshift(e), t.push(n), t;
        };
      }, t.methods.forEach(function(e) {
        t[e] = t.factory(e);
      }), t.load = function(t) {
        var e = 3e5, n = Math.ceil(new Date() / e) * e, o = document.createElement("script");
        o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + n + "/" + t + ".js";
        var i = document.getElementsByTagName("script")[0];
        i.parentNode.insertBefore(o, i);
      };
    }
  }();
  drift.SNIPPET_VERSION = '0.3.1';
  drift.load('kin4c3m7twpw');
  </script>
  <!-- End of Async Drift Code -->
</head>
<body>

  <!--Navbar-->
  <nav class="navbar navbar-expand-lg bg-success navbar-dark fixed-top">
    <div class="container">
        <a href="home-page.html" class="navbar-brand">MegaTower Hub</a>

        <button class="navbar-toggler" 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navmenu" 
            aria-controls="navmenu" 
            aria-expanded="false" 
            aria-label="Toggle navigation menu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navmenu">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                  <button type="button" class="nav-link text-light btn" data-bs-toggle="modal" data-bs-target="#notificationsModal">
                    Notifications <span id="unreadCountBadge" class="badge bg-danger">0</span>
                  </button>
                </li>
                <li class="nav-item">
                    <a href="complain-page.html" class="nav-link text-light">Complaints</a>
                </li>
                <li class="nav-item">
                    <a href="request-page.html" class="nav-link text-light">Request</a>
                </li>
                <li class="nav-item">
                    <a href="payment-page.html" class="nav-link text-light">Payment</a>
                </li>
                <li class="nav-item">
                    <a href="forum-page.html" class="nav-link text-light">Forum</a>
                </li>
                <li class="nav-item">
                    <a href="tenant-profile.html" class="nav-link text-light">Profile</a>
                </li>
                <li class="nav-item">
                    <a href="javascript:void(0);" onclick="logout()" class="nav-link text-light">Logout</a>
                </li>
            </ul>
        </div>
    </div>   
  </nav>

  <!-- Notifications Modal -->
  <div class="modal fade" id="notificationsModal" tabindex="-1" aria-labelledby="notificationsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="notificationsModalLabel">Notifications</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <!-- Sample notification content -->
          <div class="notification mb-4 p-3 border rounded">
            <h6 class="text-success">Welcome, Tenant!</h6>
            <p class="mb-0">This is the content of the first notification. You can provide more details here.</p>
          </div>

          <div class="notification mb-4 p-3 border rounded">
            <h6 class="text-warning">Maintenance Request</h6>
            <p class="mb-0">The maintenance request you submitted on 12/9/2023, 8:46:24 AM has been resolved.</p>
          </div>

          <!-- Add more notifications as needed -->
        </div>
      </div>
    </div>
  </div>

  <!--Showcase-->  
  <section class="bg-light text-dark p-5 text-center text-sm-start">
    <div class="container">
        <div class="d-sm-flex align-items-center justify-content-between">
            <div>
              <h1>Welcome to MegaTower Hub</h1>
              <p class="lead my-4 mx-3">
                Megatower Residences III is located within the city proper with a lot area of 1,192.20 m2 and a total sellable area of 8,182.70m2. It has 11 (eleven) floors consisting a total of 304 units, 296 of which are residential units while 8 are commercial spaces.
              </p>
          </div>
          <img class="img-fluid w-25 d-none d-lg-block" src="https://cdn.pixabay.com/photo/2017/10/30/20/52/condominium-2903520_960_720.png" alt="condo.png">
        </div>
        
    </div>
  </section>

  <!--Boxes-->
  <section class="p-5 bg-secondary">
    <div class="container">
      <div class="row">
        <div class="col-md">
          <div class="card bg-light text-dark">
            <div class="card-body text-center">
              <div class="h1">
                <i class="bi bi-journal"></i>
              </div>
              <div class="h3 card-title mb-3">
                Complaints
              </div>
              <p class="card-text">
                Submit your complaints here
              </p>
              <a href="complain-page.html" class="btn btn-primary">Submit</a>
            </div>
          </div>
        </div>
        <div class="col-md">
          <div class="card bg-light text-dark">
            <div class="card-body text-center">
              <div class="h1">
                <i class="bi bi-hammer"></i>
              </div>
              <div class="h3 card-title mb-3">
                Request
              </div>
              <p class="card-text">
                Submit your request here
              </p>
              <a href="request-page.html" class="btn btn-primary">Submit</a>
            </div>
          </div>
        </div>
        <div class="col-md">
          <div class="card bg-light text-dark">
            <div class="card-body text-center">
              <div class="h1">
                <i class="bi bi-receipt"></i>
              </div>
              <div class="h3 card-title mb-3">
                Payment
              </div>
              <p class="card-text">
                Check payment reminder and channels
              </p>
              <a href="payment-page.html" class="btn btn-primary">Submit</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--FAQs Accordion-->

  <section id="questions" class="p-5">
    <div class="container">
      <h2 class="text-center mb-4">Frequently Asked Questions</h2>
      <div class="accordion" id="accordionPanelsStayOpen">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
              Accordion Item #1
            </button>
          </h2>
          <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show">
            <div class="accordion-body">
              <strong>This is the first item's accordion body.</strong> It is shown by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
              Accordion Item #2
            </button>
          </h2>
          <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse">
            <div class="accordion-body">
              <strong>This is the second item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
              Accordion Item #3
            </button>
          </h2>
          <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse">
            <div class="accordion-body">
              <strong>This is the third item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false" aria-controls="panelsStayOpen-collapseFour">
              Accordion Item #4
            </button>
          </h2>
          <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse">
            <div class="accordion-body">
              <strong>This is the fourth item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false" aria-controls="panelsStayOpen-collapseFive">
              Accordion Item #5
            </button>
          </h2>
          <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse">
            <div class="accordion-body">
              <strong>This is the fourth item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--Contact and Map-->
  <section class="p-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-md">
          <h2 class="text-center mb-4">Contact Info</h2>
          <ul class="list-group list-group-flush lead">
            <li class="list-group-item">
              <span class="fw-bold">Main Location:</span>
              Sandico Corner Tecson Street, Baguio City, Benguet, Philippines
            </li>
            <li class="list-group-item">
              <span class="fw-bold">Telephone Number:</span>
              12345678910
            </li>
            <li class="list-group-item">
              <span class="fw-bold">Mobile Number:</span>
              12345678910
            </li>
            <li class="list-group-item">
              <span class="fw-bold">Email Address:</span>
              sampleemail@mail.com
            </li>
          </ul>
        </div>
        <div class="col-md">
          <div id="map">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d284.4628709620581!2d120.60037261905244!3d16.411568962184074!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3391a192a4be8ee5%3A0x841ae4c0358e364b!2sMegatower%20Residences%203!5e0!3m2!1sen!2sph!4v1701617091139!5m2!1sen!2sph" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bootstrap JS and Popper.js -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-messaging.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
  <script>
    // Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyB0w3oovf85ZTyZBfKapuZxx1i0OiGyRZ0",
      authDomain: "megatower-hub-ca285.firebaseapp.com",
      databaseURL: "https://megatower-hub-ca285-default-rtdb.firebaseio.com",
      projectId: "megatower-hub-ca285",
      storageBucket: "megatower-hub-ca285.appspot.com",
      messagingSenderId: "900973693171",
      appId: "1:900973693171:web:9062bf9b49221596294f86"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Check for authentication state changes
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in, fetch notifications
        fetchNotifications();
      } else {
        // No user is signed in.
        console.log('User not signed in.');
      }
    });
    
    // Update navbar with unread notifications count
    function updateUnreadCountBadge(count) {
      const unreadCountBadge = document.getElementById('unreadCountBadge');
      unreadCountBadge.textContent = count;
    }

    // Function to fetch notifications
    function fetchNotifications() {
      var userId = firebase.auth().currentUser.uid; // Get current user's UID
      var notificationsRef = firebase.database().ref('users/' + userId + '/notifications');

      notificationsRef.once('value', function(snapshot) {
        var notifications = snapshot.val();
        displayNotifications(notifications);
        updateUnreadCountBadge(countUnreadNotifications(notifications)); // Update unread count
      });
    }

    // Function to count unread notifications
    function countUnreadNotifications(notifications) {
      let unreadCount = 0;
      for (const key in notifications) {
        if (!notifications[key].isRead) {
          unreadCount++;
        }
      }
      return unreadCount;
    }

    // Function to display notifications
    function displayNotifications(notifications) {
      const notificationsContainer = document.querySelector('.modal-body'); // Adjust selector as needed
      notificationsContainer.innerHTML = ''; // Clear existing notifications

      // Convert object to array for sorting
      const notificationsArray = Object.entries(notifications);

      // Sort notifications based on dateTime
      notificationsArray.sort((a, b) => {
        const dateTimeA = new Date(a[1].dateTime).getTime();
        const dateTimeB = new Date(b[1].dateTime).getTime();
        return dateTimeB - dateTimeA; // Sort in descending order (recent first)
      });

      // Display sorted notifications
      notificationsArray.forEach(([key, notification]) => {
        const notificationElement = document.createElement('div');
        notificationElement.classList.add('notification', 'mb-4', 'p-3', 'border', 'rounded');
        
        // Check if the notification is unread (isRead is false)
        if (!notification.isRead) {
          notificationElement.classList.add('unread'); // Add a class for unread notifications
        }
        
        notificationElement.innerHTML = `
          <h6 class="text-warning">Notification</h6>
          <p class="mb-0">${notification.notification}</p>
        `;
        notificationsContainer.appendChild(notificationElement);
      });
    }

    // Function to fetch notifications and update read status
    function fetchNotificationsAndUpdateReadStatus() {
      var userId = firebase.auth().currentUser.uid; // Get current user's UID
      var notificationsRef = firebase.database().ref('users/' + userId + '/notifications');

      notificationsRef.once('value', function(snapshot) {
        var notifications = snapshot.val();
        // Mark notifications as read
        markNotificationsAsRead(notifications);
        // Display notifications
        displayNotifications(notifications);
        // Update unread count
        updateUnreadCountBadge(countUnreadNotifications(notifications));
      });
    }

    // Function to mark notifications as read
    function markNotificationsAsRead(notifications) {
      for (const key in notifications) {
        // Update isRead property to true
        notifications[key].isRead = true;
        // Update the isRead property in the database
        firebase.database().ref('users/' + userId + '/notifications/' + key).update({ isRead: true });
      }
    }

    // Function to mark notifications as read when modal is opened
    $('#notificationsModal').on('show.bs.modal', function (e) {
      // Fetch notifications and mark them as read
      fetchNotificationsAndUpdateReadStatus();
    });
    
    // Optional: Adjust to open the modal and fetch notifications based on your UI triggers
    $('#notificationsModal').on('show.bs.modal', function (e) {
      fetchNotifications();
    });
  </script>

    <script>
      function logout() {
        // Clear any user session or data if needed
        // Redirect to landing-page.html after logout
        window.location.href = 'index.html';
        
        // Replace the current history entry to prevent going back
        history.replaceState(null, null, location.href);
      }

    </script>
    
</body>
</html>